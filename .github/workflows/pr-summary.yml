name: PR Merge Summary

on:
  pull_request:
    types: [closed]

jobs:
  summarize:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Add merge summary comment
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const mergedAt = new Date(pr.merged_at).toLocaleString('en-US', {
              dateStyle: 'medium',
              timeStyle: 'short',
              timeZone: 'UTC'
            });

            const body = [
              '## âœ… PR Merged & Archived',
              '',
              `**Merged:** ${mergedAt} UTC`,
              `**Branch:** \`${pr.head.ref}\``,
              `**Base:** \`${pr.base.ref}\``,
              `**Commits:** ${pr.commits}`,
              `**Changed files:** ${pr.changed_files}`,
              `**Additions:** +${pr.additions}`,
              `**Deletions:** -${pr.deletions}`,
              '',
              '---',
              '*This comment was automatically added when the PR was merged.*'
            ].join('\n');

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number,
              body: body
            });

            console.log(`Added merge summary to PR #${pr.number}`);
